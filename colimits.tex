
\chapter{Colimits}
\label{chap:colim}

\epigraph{A comathematician is a device turning cotheorems into
  ffee.}{Co-Alfréd Rényi}


As seen in chapter~\ref{chap:hott}\todo[fancyline]{Not really}, adding sigma-types to type theory
results in adding limits over graphs in the underlying category, and
adding higher inductives types results in adding colimits over
graphs. If limits has been extensively studied in~\cite{lumsdaine},
theory of colimits was not completely treated.

The following is conjoint work with Simon Boulier and Nicolas
Tabareau, helped by precious discussions with Egbert Rijke.
The sections~\ref{sec:colim} and~\ref{sec:floris} are extended version
of the blog post~\cite{boulier}.

\section{Colimits over graphs}
\label{sec:colim}

As colimits are just dual to limits, it seems that it would be very
easy to translate the work on limits to colimits. Although, even if
it might be because we are more habituated to manipulate sigma-types
than higher inductive types, it seems way harder.

\subsection{Definitions}
\label{ssec:colim:defi}

Let's recall the definitions of graphs and diagrams over graphs,
introduced in~\cite{lumsdaine}.

\begin{defi}[Graph]\label{defi:graph}
  A {\em graph} $G$ is the data of
  \begin{itemize}
  \item a type $G_0$ of vertices ;
  \item for any $i,j:G_0$, a type $G_1(i,j)$ of edges.
  \end{itemize}
\end{defi}

\begin{defi}[Diagram]\label{defi:diagram}
  A {\em diagram} $D$ over a graph $G$ is the data of
  \begin{itemize}
  \item for any $i:G_0$, a type $D_0(i)$ ;
  \item for any $i,j:G_0$ and all $\phi : G_1(i,j)$, a map $D_1(\phi)
    : D_0(i) \to D_0(j)$
  \end{itemize}
\end{defi}

When the context is clear, $G_0$ will be simply denoted $G$,
$G_1(i,j)$ will be noted $G(i,j)$, $D_0(i)$
will be noted $D(i)$ or $D_i$, and $D_1(\phi)$ will be noted
$D_{i,j}(\phi)$ or simply $D(\phi)$ ($i$ and $j$ can be inferred from
$\phi$).

\begin{exms}
  \item One can consider the following graph, namely the graph of
    (co)equalizers
    \[ \xymatrix{\bullet \ar@<-.5ex>[r] \ar@<.5ex>[r] & \bullet} \]
    Here, $G_0 = \two$, $G_1(\True,\False) = \two$ and other
    $G_1(i,j)$ are empty.

    A diagram over this graph consists of two types $A$ and $B$, and
    two maps $f,g:A \to B$, producing the diagram
    \[ \xymatrix{A \ar@<-.5ex>[r]_g \ar@<.5ex>[r]^f & B} \]
  \item The graph of the mapping telescope is 
    \[ \xymatrix{ \bullet \ar[r] &\bullet \ar[r] &\cdots} \]
    In other words, $G_0=\N$ and $G_1(i,i+1) = \one$.

    A diagram over the mapping telescope is a sequence of types $P:\N
    \to \Type$ together with arrows $f_n:P_n \to P_{n+1}$:
    \[ \xymatrix{ P_0 \ar[r]^{f_0} & P_1 \ar[r]^{f_1} & \cdots} \]
\end{exms}

What we would like now would be to define the colimits of these
diagrams over graphs, that would satisfy type theoretic versions of
usual properties: it should make the diagram commute, and be universal
with respect to this property.
From now on, let $G$ be a graph and $D$ a diagram over this graph.

The commutation of the diagram is easy: the colimit should be the tip
of a cocone.

\begin{defi}[Cocone]\label{defi:cocone}
  Let $Q$ be a type. A cocone over $D$ into $Q$ is the data of arrows
  $q_i:D_i \to Q$, and for any $i,j:G$ and $g:G(i,j)$, an homotopy 
  $q_j \circ D(g) = q_i$.
\end{defi}

If $Q$ and $Q'$ are type with an arrow $f:Q\to Q'$, and if $C$ is a
cocone over $D$ into $Q$, one can easily build a cocone on $D$ into
$Q'$ by postcomposing all maps of the cocone by $f$, giving a map
\newcommand{\postcomposecocone}{\mathrm{postcompose}\_{\mathrm{cocone}}}
\newcommand{\precomposecocone}{\mathrm{precompose}\_{\mathrm{cocone}}}
\[\postcomposecocone : \cocone_D(Q) \to (Q':\Type) \to (Q \to Q') \to \cocone_D(Q') \]
The other way around (from a cocone into $Q'$, give a map $Q\to Q'$)
is exactly the second condition we seek:

\begin{defi}[Universality of a cocone]
  Let $Q$ be a type, and $C$ be a cocone over $D$ into $Q$. $C$ is
  said universal if for any type $Q'$, $\postcomposecocone(C,Q')$ is
  an equivalence.
\end{defi}

We can finally define what it means for $Q$ to be a colimit of $D$.

\begin{defi}[Colimit]\label{defi:colimit}
  A type $Q$ is said to be a colimit of $D$ if there is a cocone $C$
  over $D$ into $Q$, which is universal.
\end{defi}

\begin{exm}
  Let $A$, $B$ be types and $f,g:A\to B$.
  Let $Q$ be the HIT generated by
  $\left|
  \begin{array}{lll}
    q & : & B \to Q \\
    \alpha & : & q \circ f \homot q \circ g
  \end{array} \right. .$
Then $Q$ is a colimit of the coequalizer diagram associated to
$A,B,f,g$. We say that $Q$ is a coequalizer of $f$ and $g$.
\end{exm}

Note that for any diagram $D$, one can build a free colimit of $D$,
namely the higher inductive type $\colim(D)$ generated by
\[ 
  \left|
    \begin{array}{lll}
      \colim & : & \prodD i G {D_i \to \colim(D)} \\
      \alpha_\colim & : & \prodD {i j} G {\prodD g {G(i,j)} {\prodD x
                          {D_i} {\colim_j \circ D(g) \homot \colim_i}}}
    \end{array} \right.
\]

\subsection{Properties of colimits}
\label{ssec:prop_colim}

Diagrams can be thought as functors from type of graphs to $\Type$,
and hence one can define morphisms between diagrams as natural
transformation.

\begin{defi}[Morphism of diagram]
  Let $D$ and $D'$ be two diagrams over the same graph $G$. A morphism
  of diagram $m$ between $D$ and $D'$ is the data of
  \begin{itemize}
  \item for all $i:G$, a map $m_i : D_i \to D_i'$
  \item for all $g:G(i,j)$, a path $D'(g) \circ m_i = m_j \circ D(g)$
  \end{itemize}
  This definition leads to obvious definition of identity morphism of
  diagrams, and composition of morphisms of diagrams.
\end{defi}

Then, two diagrams $D$ and $D'$ are said to be equivalent if there is
a morphism of diagrams $m$ between $D$ and $D'$ such that all $D_i$
are equivalences. It can easily be checked that the morphism $m^{-1}$
given by inverting all $m_i$'s satisfies $m\circ m^{-1} = \id$ and
$m^{-1} \circ m = \id$.

In the previous section, we defined the map
$\postcomposecocone$ changing a cocone into $Q$ and a map
$Q\to Q'$ into a cocone into $Q'$. We now define a map
$\precomposecocone$ taking a morphism of diagrams $m$
between $D$ and $D'$, and a cocone over $D'$ into $X$, and giving a
cocone over $D$ into $X$:
\begin{defi}
  Let $m$ be a morphism of diagrams between $D$ and $D'$, and $X$ a
  type.
  Any cocone over $D'$ into $X$ can be changed into a cocone over $D$
  into $X$, by precomposing all maps in the cocone by the $m_i$'s:
  \[
    \precomposecocone : \Hom{}(D,D') \to \cocone_{D'}(X) \to \cocone_D(X).
  \]
\end{defi}

Precomposition by a morphism of diagrams and postcomposition by a
morphism are compatible with
composition and identities, in the sense that
\begin{align*}
  \precomposecocone (m\circ m') &= (\precomposecocone (m)) \circ
  (\precomposecocone(m')) \\
  \precomposecocone (\idmap) &= \idmap \\
  \postcomposecocone (\varphi \circ \varphi') &= (\postcomposecocone (\varphi)) \circ
  (\postcomposecocone (\varphi')) \\
  \postcomposecocone (\idmap) &= \idmap 
\end{align*}

These properties allows us to express functoriality properties of
colimits. If $m$ is a morphism between diagrams $D$ and $D'$, then
$\postcomposecocone^{-1} \circ
\precomposecocone$ is a map $Q \to Q'$, where $Q$
(resp. $Q'$) is a colimit of $D$ (resp. $D'$). One can even check that
if $m$ is an equivalence of diagrams, then the produced map $Q\to Q'$
is an equivalence of types. This is the lemma:
\begin{lem}
  Let $D$ and $D'$ be two equivalent diagrams, with respective
  colimits $Q$ and $Q'$. Then $Q\simeq Q'$.
\end{lem}
In particular, identity of diagrams being an equivalence, it asserts
that the colimit of a diagram is unique (up to equivalence). From now
on, as we supposed since chapter~\ref{chap:hott} the univalence axiom,
we will say {\em the} colimit of a diagram.

One more interesting property of colimits is that it is stable by
dependent sums. More precisely, let $X$ be a type, and $D_x$ a diagram
over a graph $G$ for all $x:X$. We want to link the colimits $Q_x$ of
diagrams $D_x$ with the colimit of $\sumD x X {D_x}$.
\begin{defi}[Dependent diagram]
  Let $G$ be a graph, $X$ a type and $D_x$ a diagram over $G$ for all
  $x:X$. The diagram $\sumD x X {D_x}$ is the diagram defined by
  \begin{itemize}
  \item $\left( \sumD x X {D_x} \right)(i) = \sumD x X {D_x(i)}$
  \item $\left( \sumD x X {D_x} \right)(\phi) = (\idmap, D_x(\phi))$
  \end{itemize}
\end{defi}

Note that a family $C_x$ of cocones over $D_x$ can be extended to a
cocone $\sumD x X {C_x}$ on $\sumD x X {D_x}$. Then, the expected
result is true
\begin{prop}\label{prop:colimit-sigma}
  If, for all $x:X$, $Q_x$ is the colimit of $D_x$, then $\sumD x X
  {Q_x}$ is the colimit of $\sumD x X {D_x}$.
\end{prop}
 



\subsection{Truncated colimits}
\label{ssec:trunc_colim}

As said in the introduction, we now give a
truncated version of colimits. 
Colimits actually behave well with respect to truncations. Indeed, if $D$ is a
diagram and $P$ a colimit of $D$, then $\|P\|_n$ is the $n$-colimit
of the $n$-truncated diagram $\|D\|_n$. Let's make it more precise.

\begin{defi}[Truncation of a diagram]
  Let $D$ be a diagram over a graph $G$, and $n$ a truncation index.
  Then the diagram $\|D\|_n$ is the diagram over $G$ defined by
  \begin{itemize}
  \item $(\|D\|_n)_0(i) \defeq \|D_0(i)\|_n:\Type_n$
  \item $(\|D\|_n)_1(\phi) \defeq |D_1(\phi)|_n : \|D_0(i)\|_n \to \|D_0(j)\|_n$
  \end{itemize}
\end{defi}

\begin{defi}
  Let $D$ be a diagram over a graph $G$, $P$ be a type, and $C$ a
  cocone over $D$ into $P$. $C$ is said $n$-universal if for any
  $Q:\Type_n$, $\postcomposecocone(C,Q)$ is an
  equivalence.

  Then, $P$ is said to be a $n$-colimit of $D$ if there is a cocone
  $C$ over $D$ into $Q$ which is $n$-universal.
\end{defi}

We can now give the fundamental proposition linking colimit and
$n$-colimit.

\begin{prop}\label{prop:colimit-trunc}
  Let $D$ be a diagram, and $P:\Type$.
  Then, if $P$ is a colimit of $D$, $\|P\|_n$ is a $n$-colimit of $\|D\|_n$.
\end{prop}

The proof of this is really straightforward: a cocone over $D$ into
$P$ can be changed equivalently into a cocone over $\|D\|_n$ into $\|P\|_n$, using the
elimination principle~\ref{lem:trunc_elim} of truncations, and then
we can show that the following diagram commutes for any $X:\Type_n$
\[
  \xymatrix{
    \|P\|_n \to X \ar[r] \ar[d]^*[@]{\hbox to 0pt{\hss$\sim$\hss}} & \mathrm{cocone}(\|D\|_n,X) \\
    P \to X \ar[r]^\sim& \mathrm{cocone}(D,X) \ar[u]^*[@]{\hbox to 0pt{\hss$\sim$\hss}}
  }
\]

\begin{rmq}
This result does not hold for limits. If it were
true, then applying it to the following equalizer diagram
\[ \xymatrix{ A \ar@<-.5ex>[r]_{\lambda \_,\,y} \ar@<.5ex>[r]^f & B }\]
with $A,B:\Type$, $f:A\to B$ and $y:B$ would lead to an equivalence
\[ \left\| \sumD a A {f a = y} \right\|_{n} \simeq \sumD a {\|A\|_{n}}
  {|f|_{n}\, a = |y|_{n}}, \]
proving left-exactness of $n$-truncation.  
\end{rmq}

\subsection{Towards highly coherent colimits}
\label{ssec:high_colimit}

In category theory, a diagram over a graph $G$ in a category $\mathcal
C$ is a functor $G \to \mathcal C$. Our definition of diagrams doesn't
reflect this definition, as we don't take care of composition of
morphisms in the category (actually, we only define a map
$G\to\mathcal C$). Diagrams over a category are defined
in~\cite[Exercise 7.16]{hottbook}. We will here define these diagrams,
and the associated colimits.

\begin{rmq}
  This new definition of diagrams is not sufficient to reflect what we
  would want to express. If we view homotopy type theory as
  $\omega$-topos theory, what we want is rather a $\omega$-functor
  from a graph into the $\omega$-topos. That is an important open
  problem in homotopy type theory (even defining simplicial types is
  an open problem). It requires to handle an infinity of coherence
  levels, with finite data. 

  However, we could define, for any fixed $n$, diagrams and colimits
  coherent up to coherence level $n$ (but that would be a real nightmare).
\end{rmq}

The main goal of this section is to define the colimit of the
coequalizer with degeneracy $\delta$
\[
  \xymatrix{
    A \ar@<-.5ex>[r]_g \ar@<.5ex>[r]^f & B \ar@/_2pc/[l]_\delta
  }
\] 
and compositions $c_f:f \circ \delta = \idmap$ and $c_g:g \circ \delta =
\idmap$. We will use this coequalizer to define the Boulier's
construction in next section~\ref{sec:floris}.

If we only take the previous definition of colimits, what we miss is
the commutation of the following diagram

\[
  \xymatrix{
    q \circ f \circ \delta \ar[r]^-{q \circ c_f} \ar[d]_-{\alpha \circ \delta} & q \\
    q\circ g \circ \delta \ar[ru]_-{q\circ c_g}
  }
\]

Our idea to define the colimit of this diagram with degeneracy is to
add it directly into the definition of the higher inductive type:
\[
  \left|
    \begin{array}{lll}
      \colim&:& B \to Q \\
      \colim_\alpha&:& \prodD x A {f\, x = g\, x}\\
      \colim_\alpha^\circ &:& \prodD y B {\colim_\alpha(\delta\, y) =
                              \concat {c_f(y)} {\inv{c_g(y)}}}
    \end{array}
  \right.
\]

\begin{rmq}
  We indeed see here why this idea cannot be extended to a fully
  coherent notion of colimits: we cannot define a higher inductive
  type with an infinity of constructors. Hopefully, adding this first
  level of coherence will be sufficient for our applications.
\end{rmq}

The new constructor $\colim_\alpha^\circ$ indeed asserts the
commutation of the desired diagram. We can view this higher inductive
type as the same type as the colimit over the coequalizer graph, but
which does not add already existing paths.

One can easily (but very technically) check that properties in
section~\ref{ssec:prop_colim} are still satisfied by this new notion
of colimit.


\section{Van Doorn's and Boulier's constructions}
\label{sec:floris}

In topos theory, there is a result that we would want to use in
chapter~\ref{chap:sheaf}:
\begin{lem}[{\cite[IV.7.8]{maclanemoerdijk}}]
  In a topos $\mathcal E$, if $f\in\Hom{\mathcal E}(A,B)$ is an epimorphism, then the colimit
  of
  \[ \xymatrix{ A\times_B A \ar@<-.5ex>[r]_-{\pi_2}
      \ar@<.5ex>[r]^-{\pi_1} & A }\]
  is $B$. The pullback $A\times_B A$ is called the kernel pair of $f$.
  
\end{lem}
Unfortunately, this result fails in higher topos ; the kernel pair
should be replaced by the \v{C}ech nerve of $f$.
\[
  \xymatrix{
    \dots \ar@<-1ex>[r]\ar@<-.33ex>[r]\ar@<.33ex>[r]\ar@<1ex>[r] & A\times_B A\times_B A \ar@<-.7ex>[r] \ar[r] \ar@<.7ex>[r]
    & A\times_B A \ar@<-.5ex>[r] \ar@<.5ex>[r] & A \ar[r]^f_{\colim}& B
  }
\]
The issue we face in homotopy type theory is that the definition of
the \v{C}ech nerve, and in general of simplicial objects is a hard
open problem. It involves an infinite tower of coherences, and we
do not know how to handle this. However, there is a way to define a
diagram depending on a map $f$, which colimit is $\im(f)$.

The starting point of the construction is Floris Van Doorn's
construction of proposition truncation~\cite{floris}. 

\begin{prop}[Van Doorn's construction]\label{prop:floris}
  Let $A:\Type$. We define the higher inductive type $TA$ as the
  coequalizer of
  \[ \xymatrix{ A\times A \ar@<-.5ex>[r]_-{\pi_2}
      \ar@<.5ex>[r]^-{\pi_1} & A }.\]
  The colimit of the diagram
  \[ \xymatrix{
      A \ar[r]^-q& TA \ar[r]^-q& TTA \ar[r]^-q& TTTA \ar[r]^-q& \dots
    }\]
  is $\|A\|_{-1}$.
\end{prop}
Let's compare the direct definitions of $\|A\|_{-1}$ and $TA$
\[
  \|A\|_{-1} \left|
    \begin{array}{lll}
      \tr &:& A\to\|A\|_{-1} \\
      \alpha_{\tr} &:& \prodD {x,y}{\|A\|_{-1}}{x=y}
    \end{array}
  \right.
  \qquad
  TA \left|
    \begin{array}{lll}
      q &:& A\to TA \\
      \alpha &:& \prodD {x,y}{A}{q\, x=q\, y}
    \end{array}
  \right.
\]
The definitions are almost the same, except that the path constructor
of $TA$ quantifies over $A$, while the one of $\|A\|_{-1}$ quantifies
over $\|A\|_{-1}$ itself: such a higher inductive type is a {\em
  recursive} inductive type. Thus, proposition~\ref{prop:floris}
allows us to build the truncation in a non-recursive way. The
counterpart is that we have to iterate the
construction. In~\cite{boulier}, we found a way to generalize a bit
this result. The main idea is that iterating the kernel pair
construction will result in a diagram of colimit $\im(f)$.

Now, let $A,B:\Type$ and $f:A\to B$. We define the kernel pair of $f$
as the coequalizer of \[ \xymatrix{ A\times_B A \ar@<-.5ex>[r]_-{\pi_2}
      \ar@<.5ex>[r]^-{\pi_1} & A }.\]
In other words, $\KP(f)$ is the higher inductive type generated by
\[\left|
    \begin{array}{lll}
      \kp &:& A\to \KP(f) \\
      \alpha &:& \displaystyle{\prodD {x,y}{A}{f\, x = f\, y \to \kp\,x=\kp\,y}}
    \end{array}
  \right.\]
Using the eliminator of coequalizers, one can build a map $\widehat
f:\KP(f) \to B$, such that the following commutes
\[\xymatrix{
    A \ar[r]^-{\kp} \ar[rd]_-f & \KP(f) \ar[d]^-{\widehat f} \\
    &B
}\]
Then we can build $KP(\widehat f)$ and build a map $\widehat{\widehat
  f}:\KP(\widehat f) \to B$, \etc{}
We have the following result
\begin{prop}[Boulier's construction]\label{prop:cech'}
  For any $f:A\to B$, $\im(f)$ is the colimit of the iterated kernel
  pair diagram of $f$
\[\xymatrix{
  A \ar[r] & \KP(f) \ar[r] & \KP\left(\widehat f\right) \ar[r]& \KP\left(\widehat{\widehat f}\right) \ar[r]& \cdots
}\]
In particular, if $f$ is a surjection, the colimit of this diagram is $B$.
\end{prop}
\begin{proof}
  The main idea of the proof is the equivalence between the diagrams
\[
\xymatrix{
  A \ar[r] & \KP(f) \ar[r] & \KP\left(\widehat f\right) \ar[r]&
  \cdots & \\
  \displaystyle{\sumD y B {\fib f y}} \ar[r] & \displaystyle{\sumD y B {T(\fib f y)}} \ar[r]& \displaystyle{\sumD
  y B {TT(\fib f y)}} \ar[r]&  \cdots &
}
\]

Let's begin by showing the first non-trivial equivalence: 
\begin{equation}
  \label{eq:KP}
  s: \KP(f) \simeq \sumD y B {T(\fib f y)}.  
\end{equation}

$\KP(f)$ is the colimit of $\xymatrix{ A\times_B A \ar@<-.5ex>[r]_-{\pi_2}
  \ar@<.5ex>[r]^-{\pi_1} & A }$, and $\sumD y B {T(\fib f y)}$ is
the colimit of $\xymatrix{ \sumD y B {\fib f y \times \fib f y} \ar@<-.5ex>[r]
  \ar@<.5ex>[r] & \sumD y B {\fib f y} }$.
As the two diagrams are equivalent, their colimits are equivalent. We
will need the following fact, easily checked
\[ \pi_1 \circ s = \widehat f.\]

Now, let's prove the other equivalences. We need the following lemma
\begin{lem}
  Let $X,Y:\Type$ and $\varphi:X\to Y$. Then $\fib{\widehat\varphi}y
  \simeq T(\fib\varphi y)$.
\end{lem}
\begin{prooflem}
  We have the following sequence of equivalences:
  \begin{align*}
    \fib{\widehat\varphi}y 
    &\defeq \sumD x {\KP(\varphi)}{\widehat \varphi\, x = y} \\
    &\simeq \sumD x {\sumD y B {T(\fib \varphi y)}} {\widehat \varphi \circ s^{-1}
      (x) = y} \quad\text{by \ref{eq:KP}} \\
    &\simeq\sumD x {\sumD y B {T(\fib \varphi y)}} {\pi_1(x) = y} \\
    &\simeq T(\fib \varphi y)
  \end{align*}
\end{prooflem}
Then, using the sum-of-fibers property, we can change the iterated
kernel pair of $f$ into
\[
\xymatrix{
\displaystyle{\sumD y B {\fib f y}} \ar[r] & \displaystyle{\sumD y B
  {\fib{\widehat f}y}} \ar[r]& \displaystyle{\sumD
  y B {\fib{\widehat{\widehat f}} y}} \ar[r]&  \cdots &
}
\]
With the just proved lemma, and a bit of induction, we can prove the
desired equivalence of diagrams.

As colimits are stable under dependent sum, we know that the colimit
of the diagram is thus $\sumD y B {Q\, y}$, where $Q$ is the colimit
of
\[\xymatrix{\displaystyle{{\fib f y}} \ar[r] & \displaystyle{{T(\fib f
        y)}} \ar[r]& \displaystyle{{TT(\fib f y)}} \ar[r]&  \cdots
    &}\]
But proposition~\ref{prop:floris} asserts that $Q \simeq \|\fib f
y\|_{-1}$, and the result is proved.
\end{proof}

The main issue with Van Doorn's construction is
that is does not preserve truncations levels at all. For example, when
computing $\|\one\|_{-1}$, the first step is $T\one \simeq \Sone$,
which is a $1$-type. 
Asking for preservation of all truncation levels along the diagram
might be too much, but the least we could ask is that when starting
with a $P:\HProp$, the diagram should be the constant diagram $P\to
P \to P\to \cdots$. The Boulier counterpart of this is, when starting
with an embedding $f$, all $\widehat f$ are embeddings. 

This can be achieve by changing operators $T$ and $\KP$, by asking
them to preserve identities:
\[
  TA~\left|
    \begin{array}{lll}
      q&:& A\to TA \\
      \alpha&:& \displaystyle{\prodD {x,y} A {q\, x = q\, y}} \\
      \alpha_1&:& \displaystyle{\prodD x A {\alpha(x,x) = 1}}
    \end{array}
  \right.
  \quad ; \quad
  \KP(f)~\left|
    \begin{array}{lll}
      \kp&:&A\to \KP(f) \\
      \alpha&:& \displaystyle{\prodD {x,y} A {f\, x = f\, y \to q\, x = q\, y}} \\
      \alpha_1&:& \displaystyle{\prodD x A {\alpha(x,x,1) = 1}}
    \end{array}    
  \right.
\]

This new $\KP$ can be thought of as the coequalizer preserving the
``degeneracy'' $\delta$, as in section~\ref{ssec:high_colimit}:
\[ 
  \xymatrix{
    A\times_B A \ar@<-.5ex>[r]_-{\pi_2}
    \ar@<.5ex>[r]^-{\pi_1} & A \ar@/_2pc/[l]_\delta
  }
\]

Then, the following is still true

\begin{prop}[Boulier's construction]\label{prop:cech}
  For any $f:A\to B$, $\im(f)$ is the colimit of the iterated kernel
  pair diagram of $f$
\[\xymatrix{
  A \ar[r] & \KP(f) \ar[r] & \KP\left(\widehat f\right) \ar[r]& \KP\left(\widehat{\widehat f}\right) \ar[r]& \cdots
}\]
Moreover, if $f$ is an embedding, $\widehat f$ also is.
\end{prop}
The proof is almost the same as for proposition~\ref{prop:cech'},
except that the new constructors in the higher inductives types
introduce another level of coherence, which is very technical to
handle.

\section{Formalization}
\label{sec:colim-formalization}

All this chapter has been formalized with Coq, defining a library for
colimits on top of the Coq/HoTT library~\cite{hottlib}, based on the
formalization of limits in~\cite{lumsdaine} for the basic definitions
of graph, diagram, \etc{}

The root folder of the library formalizes results about general
colimits over graphs, with the following key results:
\begin{itemize}
\item \code{Colimit\_prod.is\_colimit\_prod} shows that if $D$ is a
  diagram, and $A\times D$ the diagram where each node $X$ of $D$ is
  changed into $X\times D$, then $A\times\colim D$ is a colimit of
  $A\times D$.
\item \code{Colimit\_Sigma.is\_colimit\_sigma} shows the commutation
  of colimits with dependent sums, as in
  proposition~\ref{prop:colimit-sigma}.
\item \code{Colimit\_trunc.tr\_colimit} shows the
  proposition~\ref{prop:colimit-trunc} about truncated colimits.
\end{itemize}

The second part of the library, in folder \code{IteratedKernelPair},
formalizes the section~\ref{sec:floris}. We note that the
formalization for the kernel pair preserving degeneracy involves a lot
of manipulation of paths between paths.



% \section{Towards groupoid objects}
% \label{sec:groupoid}

% Defining groupoid objects in homotopy type theory is an open problem,
% just as defining simplicial or even semisimplicial types. We will just
% give here some of our thoughts about this problem.

% The first thing to say is that defining a groupoid object in type
% theory is exactly the same problem as defining a highly coherent
% equivalence relation. At the moment, the only fully coherent
% equivalence relation we know in homotopy type theory is the equality,
% which we can slightly modify to create another ones. For example, if
% $f:A\to B$, the relation $f\, x = f\, y$ defines an equivalence
% relation on $A$.
% Actually, when seeing homotopy type theory as the language of
% $\omega$-topoi, the Giraud-Rezk-Lurie axioms in~\cite{lurie} asserts
% that these are the only equivalence relation we can define.

% We will call a {\em uncoherent equivalence relation}, or UER, on a
% type $A$ any symmetric, reflexive and transitive relation $R$ on $A$,
% \ie{} $R$ is a UER on $A$ if
% \begin{enumerate}
% \item For all $x,y:A$, $R(x,y) : \Type$
% \item For all $x,y:A$, $\Sym_R(x,y) : R(x,y) \to R(y,x)$
% \item For all $x:A$, $\Refl_R(x) : R(x,x)$
% \item For all $x,y,z:A$, $\Trans_R(x,y,z) : R(x,y) \to R(y,z) \to R(x,z)$
% \end{enumerate}

% Then, if we want to mimic the behaviour of equalities, we can think of
% an equivalence relation on $A$ as the data of an UER $R_0$ on $A$, and for all
% $x,y:A$, an UER $R_1^{x,y}$ on $R(x,y)$, and for all $u,v:R(x,y)$, an
% UER $R_2^{u,v}$ on $R_1(u,v)$, \etc
% This can be formalized by a coinductive type $R:\mathrm{ER}(A)$ with
% constructors
% \begin{itemize}
% \item $R_0$ is an UER on $A$
% \item $R_1:\prodD {x,y} A {\mathrm{ER}(R_0(x,y))}$
% \end{itemize}
% The issue with such a definition is that all these uncoherent
% equivalence relation have to be coherent with each other, for example
% we want
% \[
%   R_1^{x,x}\left(\Trans_{R_0}(x,x,x)\, \Refl_{R_0}(x)\, \Refl_{R_0}(x),\Refl_{R_0}(x)\right)
% \]
% Adding all these desired coherences by hand is not an option, as there
% are an infinity of them.

% The next idea is to use the Boulier's construction. Let $R_0$ be an
% UER on a type $A$. We define then the higher inductive type $\Xi_0$
% generated by
% \[
%   \left|
%     \begin{fracarray}{lll}
%       \xi_0&:&A \to \Xi_0 \\
%       \alpha_0&:& \displaystyle{\prodD {x,y} A {R_0(x,y) \to \xi_0\, x =
%                         \xi_0\, y}} \\
%       \alpha_0^{\Refl}&:& \displaystyle{\prodD x A {\alpha_0(x,x,\Refl_{R_0}(x)) =
%                           1}} \\
%       \alpha_0^{\Sym}&:& \displaystyle{\prodD {x,y} A {\prodD u {R_0(x,y)}
%                          {\alpha_0(y,x,\Sym_{R_0}(u)) =
%                          \inv{(\alpha_0(x,y,u))}}}} \\
%       \alpha_0^{\Trans} &:& \displaystyle{\prodD {x,y,z} A 
%                             {\prodD u {R_0(x,y)}
%                             {\prodD v {R_0(y,z)}
%                             {\alpha_0(x,z,\Trans_{R_0}(u,v)) = \concat {\alpha_0(x,y,u)}{\alpha_0(y,z,v)}}}}}
%     \end{fracarray}
%   \right.
% \]
% $\Xi_0$ can be seen as the quotient type of $A$ by $R_0$. In other
% words, $\Xi_0$ is the same type as $A$, but where $R_0$ has been
% changed by equalities.
% Then, an equivalence relation on $A$ could be defined coinductively as an UER $R_0$ on $A$
% together with an equivalence relation on $\Xi_0$.

% Our hope is that the Boulier's construction is still valid in this
% context, \ie{} that if we consider the colimit $\Xi_\omega$ of the
% diagram
% \[
%   \xymatrix{
%     A \ar[r] \ar[rrd]_{\zeta} & \Xi_0 \ar[r] \ar[rd]^{\zeta_0} & \Xi_1
%     \ar[r] \ar[d]^{\zeta_1} & \cdots \ar@{-->}[ld] \\
%     &&\Xi_\omega&}
% \]
% then the equivalence relation defined by $(R_i)$ is equivalent to the
% equivalence relation on $A$ defined by $x\sim y \defeq \zeta\, x =
% \zeta\, y$.

% \todo[inline]{Define groupoid objects in HoTT, then write it here}
%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
